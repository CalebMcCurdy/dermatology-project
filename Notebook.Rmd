---
title: "ADS 503: Final Team Project"
author: "Caleb McCurdy, Mirna Philip, and Christine Vu"
date: "June 5, 2023"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

***

## Data Importing and Pre-processing
```{r message = FALSE, warning = FALSE, results = 'hide'}
library(readr)
#library(RTextTools)
library(readxl)
library(ggplot2)
library(tidyr)
library(dplyr)
library(corrplot)
library(mlbench)
library(moments)
library(e1071)
#mlbench because it provides a collection of various datasets
library(caret)
library(Hmisc)
library(plotly)
library(psych)
library(MASS)
library(AppliedPredictiveModeling)
library(glmnet)
```

```{r}
df <- read.table('https://raw.githubusercontent.com/mirna1983/dermatology-project/main/data/dermatology.data', sep = ",")

head(df, 6)
```

```{r}
#dimension of data (rows and columns)
dim(df)
```

&nbsp;

#### Add Column Names

The data frame is missing the column names that correspond to the provided attribute list. Therefore, the column names are appended based on the attribute information list.

```{r, warnings = FALSE}
# Desired column names
desired_columns <- c("erythema", "scaling", "definite_borders", "itching", "koebner_phenomenon", "polygonal_papules", "follicular_papules", "oral_mucosal_involvement", "knee_and_elbow_involvement", "scalp_involvement", "family_history", "melanin_incontinence", "eosinophils_in_the_infiltrate", "PNL_infiltrate", "fibrosis_of_the_papillary_dermis", "exocytosis", "acanthosis", "hyperkeratosis", "parakeratosis", "clubbing_of_the_rete_ridges", "elongation_of_the_rete_ridges", "thinning_of_the_suprapapillary_epidermis", "spongiform_pustule", "munro_microabcess", "focal_hypergranulosis", "disappearance_of_the_granular_layer", "vacuolisation_and_damage_of_basal_layer", "spongiosis", "saw-tooth_appearance_of_retes", "follicular_horn_plug", "perifollicular_parakeratosis", "inflammatory_monoluclear_inflitrate", "band-like_infiltrate", "Age", "class")

# Assign desired column names
colnames(df) <- desired_columns
head(df, 3)
```

```{r}
#summary of the data frame
summary(df)
```

```{r}
str(df)
```

```{r}
# changing 'Age' into type numeric
df$Age <- as.numeric(df$Age)
```


```{r}
# checking for missing values
sapply(df, function(x) sum(is.na(x)))
```

There are no missing values in this data set other than for the 'Age' predictor which has 8. Due to the small number of instances with missing values, we will delete these rows from our data set.

```{r}
rows_with_NA <- which(is.na(df$Age))
rows_with_NA

df <- df[-rows_with_NA, ]
df
```

```{r}
# checking for potential duplicate instances
sum(duplicated(as.matrix(df), fromLast = FALSE))
```

There are no duplicate instances to deal with.

```{r}
# make the graphs smaller by having 3 rows of graphs and 4 columns 
par(mfrow = c(3,4))

hist.data.frame(df)
```

```{r}
# Plotting the correlation matrix using the corrplot function, only using 
# complete pairs of observations between variables
corrplot(cor(df), cl.cex= .5,tl.cex=.4)
```

```{r}
# plotting boxplots of the 34 predictors and response variable
boxplot(df[1:7])
boxplot(df[8:14])
boxplot(df[15:21])
boxplot(df[22:28])
boxplot(df[29:35])
```

```{r}
# skewness of numeric predictors
skewness_values <- apply(df, 2, skewness, na.rm = TRUE)
skewness_values
```

```{r}
pred <- df[,-35]
class <- df$class

# split the data into training (80%) and test (20%) sets
set.seed(123)
training <- createDataPartition(class, p = 0.8, list = FALSE)
pred_train <- pred[training,]
class_train <- class[training]
pred_test <- pred[-training,]
class_test <- class[-training]

# pre-process the data
preProcValues <- preProcess(pred_train, method = c("center", "scale"))

pred_train_trans <- predict(preProcValues, pred_train)
pred_test_trans <- predict(preProcValues, pred_test)

indx <- createFolds(class_train, returnTrain = TRUE)
ctrl <- trainControl(method = "cv", index = indx)
```

```{r}
## USE pred_train_trans AS THE TRAIN X SET
## USE pred_test_trans AS THE TEST X SET
## USE class_train AS THE TRAIN Y SET
## USE class_test AS THE TEST Y SET
```
```{r}
# Setting the control parameters for the training
ctrl <- trainControl(method = "cv", number = 10)
# Defining the grid of hyperparameters for the neural network
nnetGrid <- expand.grid(decay = c(0, 0.01, .1), size = c(3, 7, 11, 13))
# Setting seed for reproducibility
set.seed(123)
# Training the neural network
nnetTune <- train(x = pred_train_trans, y = class_train,
                  method = "nnet",
                  tuneGrid = nnetGrid,
                  trControl = ctrl,
                  preProc = c("center", "scale"),
                  linout = TRUE,
                  trace = FALSE,
                  MaxNWts = 13 * (ncol(pred_train_trans) + 1) + 13 + 1,
                  maxit = 1000)
nnetTune
```
```{r}
#finding the row with the lowest RMSE
nnetTune$results[nnetTune$results$RMSE == min(nnetTune$results$RMSE), 3:5]
```



